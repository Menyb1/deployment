#!/usr/bin/env python

"""
Extract option settings from an Elastic Beanstalk environment
manifest provided on STDIN and print them in the JSON format expected
by the AWS CLI's `--option-settings` parameter.
"""

import json
import sys
import yaml


def main():
    manifest = yaml.load(sys.stdin)
    settings = convert(manifest.get('OptionSettings', {}))
    print(json.dumps(settings, indent=2))


def convert(option_settings):
    settings = []
    for namespace, options in option_settings.items():
        for key, value in options.items():
            setting = {'Namespace': namespace,
                       'OptionName': key,
                       'Value': convert_value(value)}
            settings.append(setting)
    return settings


def convert_value(value):
    if isinstance(value, bool):
        return json.dumps(value)
    return value

if __name__ == "__main__":
    main()
